@model LC_Reports_V1.Models.LCfilterInfo;

@{
    ViewBag.Title = "View";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@*<h3>Add/Edit Details</h3>*@

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <!-- Google tag (gtag.js) -->
    <script async=async src="https://www.googletagmanager.com/gtag/js?id=G-GKX0NP1SYR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-GKX0NP1SYR');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartLab - Reporting Options</title>

    <link href="~/Content/LabReportPage.css" rel="stylesheet" />
    <link href="~/Content/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    @section Scripts{

        <script type="text/javascript">

            $(window).on("load", function () {
                localStorage.clear();
                $(".loader-wrapper").fadeOut("slow");

            });
            var model;
            var location;
            var labid;
            var reader;
            $(document).ready(function () {
                debugger;
                $("#selectLocation").prop('disabled', true);
                $("#selectLabId").prop('disabled', true);
                $("#view").prop('disabled', true);
                document.querySelector(".loader-wrapper").style.display = "visible"
                //document.querySelector('#card1').style.pointerEvents = 'none';
                //document.querySelector('#card2').style.pointerEvents = 'none';
                //document.querySelector('#card3').style.pointerEvents = 'none';
                //document.querySelector('#card4').style.pointerEvents = 'none';
                document.getElementById('save').style.pointerEvents = 'none';
                //document.getElementById('import').style.pointerEvents = 'none';

                reloadCheck();
            });

           function reloadCheck()
            {
            debugger;

            if (@Model.Submit.ToString().ToLower()) {
                debugger;

                var vLabType = "@Model.LCLabType";
                var arLabType = vLabType.split("|");

                for( var i = document.getElementById('selectLabType').options.length-1;i>=0; i-- )
                {
                    if(document.getElementById('selectLabType').value.indexOf(document.getElementById('selectLabType').options[i].value) != 0)
		            if(arLabType.indexOf(document.getElementById('selectLabType').options[i].value)!= -1)
		            {
                        document.getElementById('selectLabType').options[i].selected = true;

		            }
                }
                //fnLabTypeChange(document.getElementById('selectLabType'));
                var vLocation = "@Model.LCLocationName";
                var arLocation = vLocation.split("|");
                for( var i = document.getElementById('selectLocation').options.length-1;i>=0; i-- )
                {
                    if(document.getElementById('selectLocation').value.indexOf(document.getElementById('selectLocation').options[i].value) != 0)
		            if(arLocation.indexOf(document.getElementById('selectLocation').options[i].value) != -1)
		            {
                        document.getElementById('selectLocation').options[i].selected = true;
		            }
                }
                fnSitesChange(document.getElementById('selectLocation'));
                for( var i = document.getElementById('selectLabId').options.length-1;i>=0; i-- )
	            {
		            if(document.getElementById('selectLabId').options[i].value == "@Model.LCLabID")
		            {
                        document.getElementById('selectLabId').options[i].selected = true;
                        break;
		            }
                }
                debugger;

                $("#selectLocation").prop('disabled', false);
                $("#selectLabId").prop('disabled', false);
                $("#view").prop('disabled', false);
                document.querySelector('#card1').style.pointerEvents = 'auto';
                document.querySelector('#card2').style.pointerEvents = 'auto';
                document.getElementById('save').style.pointerEvents = 'auto';
                //document.getElementById('import').style.pointerEvents = 'auto';
                document.querySelector(".loader-wrapper").style.display = "none"
                $('#myModal').modal('show')
                }
            }

            function validatepage() {
                if ((document.getElementById('selectLabType').selectedIndex > 0) && (document.getElementById('selectLocation').selectedIndex > 0) && (document.getElementById('selectLabId').selectedIndex > 0) && validateDate()) {

                    $("#gen").prop('disabled', false);
                    return true;
                }
                else {
                    // add pop up message
                    return false;
                }
            }


            function fnLabTypeChange(labtypeselect) {
                debugger;
                    $('#selectLabType').change(function(){
                        $('#selectLocation option:first').prop('selected', 'selected');
                        $('#selectLabId option:first').prop('selected', 'selected');
                    });
                document.getElementById('selectLabId').selectedIndex = -1;
                document.getElementById('selectLocation').selectedIndex = -1;
                document.getElementById('LCLocationName').value = "";
                if (document.getElementById('selectLabType').selectedIndex > 0) {
                    document.getElementById("selectLocation").disabled = false;
                    document.getElementById('LCLabType').value = "";
                }
                else {
                    document.getElementById("selectLocation").disabled = true;
                }
                var result = [];
                var options = labtypeselect && labtypeselect.options;
                var opt;
                for (var i = 0, iLen = options.length; i < iLen; i++) {
                    opt = options[i];

                    if (opt.selected) {
                            document.getElementById('LCLabType').value += document.getElementById('selectLabType').options[i].value +"|";
                    }
                }

                if(@Model.Submit.ToString().ToLower())
                {
	                for( var i = document.getElementById('selectLabType').options.length-1;i>=0; i-- )
	                {
		                if(document.getElementById('selectLabType').options[i].selected)
                        {
                            debugger;
                            if(document.getElementById('LCLabType').value.indexOf(document.getElementById('selectLabType').options[i].value) == -1 )
			                    document.getElementById('LCLabType').value += document.getElementById('selectLabType').options[i].value +"|";

		                }
	                }
                }
            }

            function fnSitesChange(siteSelect) {
                debugger;
                $('#selectLocation').change(function () {
                    $('#selectLabId option:first').prop('selected', 'selected');

                });

                if (document.getElementById('selectLocation').selectedIndex > 0) {
                    document.getElementById("selectLabId").disabled = false;
                        document.getElementById('LCLocationName').value = "";
                }
                else {
                    document.getElementById("selectLabId").disabled = true;
                }

                document.getElementById('selectLabId').selectedIndex = -1;
                var result = [];
                var siteOptions = siteSelect && siteSelect.options;
                var siteSel;
                var type = document.getElementById("selectLabType");
                var typeOptions = type.options;
                var typeSel;
                document.getElementById("selectLabId").innerHTML = "";
                var labOptions = "";
                labOptions += "<option value=''>--Select LabID--</option>";
                //var foundmatch = false;
                for (var i = 0, iLen = typeOptions.length; i < iLen; i++) {
                    for (var j = 0, jLen = siteOptions.length; j < jLen; j++) {
                        siteSel = siteOptions[j];
                        typeSel = typeOptions[i];
                        if (siteSel.selected && typeSel.selected) {
                            //alert(opt.value);


                                @foreach (var item in Model.objFilterPageExpInfo.Labs)
                                {
                                    <text>
                            if (typeSel.value == "@item.Model" && siteSel.value == "@item.Location") { labOptions += "<option value='@item.id'>" + "@item.name" + "</option>"; }
                                    </text>
                                };

                            if(document.getElementById('LCLocationName').value.indexOf(siteSel.value) == -1 )
                                document.getElementById('LCLocationName').value += siteSel.value + "|";
                            //foundmatch = true;
                            //break;

                        }

                    }
                    //if (foundmatch)
                    //        break;
                }
                document.getElementById("selectLabId").innerHTML = labOptions;
                var select = $("#selectLabId");
                select.html(select.find('option').sort(function (x, y) {
                    // to change to descending order switch "<" for ">"
                    return $(x).text() > $(y).text() ? 1 : -1;
                }));
                //onchange function of LabLocation
                if (document.getElementById('selectLocation').selectedIndex > 0) {

                    if (@Model.Submit.ToString().ToLower()) {
                        for (var i = document.getElementById('selectLocation').options.length - 1; i >= 0; i--) {
                            if (document.getElementById('selectLocation').options[i].selected) {
                                if(document.getElementById('LCLocationName').value.indexOf(document.getElementById('selectLocation').options[i].value) == -1 )
                                    document.getElementById('LCLocationName').value += document.getElementById('selectLocation').options[i].value + "|";
                            }
                        }
                    }
                }
            }

            function fnLabIDChange()
            {
                debugger;
                //onchange function of LabID
                if (document.getElementById('selectLabId').selectedIndex != -1) {

                    document.getElementById('LCLabID').value = document.getElementById('selectLabId').options[document.getElementById('selectLabId').selectedIndex].value;
                }
                else {
                    alert("Please Select appropriate filter condition")
                }

                if(@Model.Submit.ToString().ToLower())
                {
	                for( var i = document.getElementById('selectLabId').options.length-1;i>=0; i-- )
	                {
		                if(document.getElementById('selectLabId').options[i].selected)
		                {
			                document.getElementById('LCLabID').value = document.getElementById('selectLabId').options[i].value;
                            //var labid=document.getElementById('LCLabID').value;
		                }
	                }
                }
                validatepage();
            }


            function validatechart() {
                if (!((document.getElementById('selectLabType').selectedIndex != -1) || (document.getElementById('selectLocation').selectedIndex != -1) || (document.getElementById('selectLabId').selectedIndex != -1))) {
                    alert("Input Parameters not selected")
                }
            }

            function readText(filePath) {
                var jsondata;
                var sdate;
                debugger;
                var output = "";
                if(filePath.files && filePath.files[0]) {
                    reader.onload = function (e) {
                    output = e.target.result;
                    jsondata = JSON.parse(output);
                    debugger;
                    //to be edited
                        var vLabType = jsondata.Model;
                        var arLabType = vLabType.split("|");

                    for( var i = document.getElementById('selectLabType').options.length-1;i>=0; i-- )
                    {
                        if(document.getElementById('selectLabType').value.indexOf(document.getElementById('selectLabType').options[i].value) != 0)
		                if(arLabType.indexOf(document.getElementById('selectLabType').options[i].value)!= -1)
		                {
                            document.getElementById('selectLabType').options[i].selected = true;

		                }
                    }
                    //fnLabTypeChange(document.getElementById('selectLabType'));
                        var vLocation = jsondata.Location;
                    var arLocation = vLocation.split("|");
                    for( var i = document.getElementById('selectLocation').options.length-1;i>=0; i-- )
                    {
                        if(document.getElementById('selectLocation').value.indexOf(document.getElementById('selectLocation').options[i].value) != 0)
		                if(arLocation.indexOf(document.getElementById('selectLocation').options[i].value) != -1)
		                {
                            document.getElementById('selectLocation').options[i].selected = true;
		                }
                    }
                    fnSitesChange(document.getElementById('selectLocation'));
                    for( var i = document.getElementById('selectLabId').options.length-1;i>=0; i-- )
	                {
		                if(document.getElementById('selectLabId').options[i].value == jsondata.LabID)
		                {
                            document.getElementById('selectLabId').options[i].selected = true;
                            break;
		                }
                    }
                    debugger;

                    $("#selectLocation").prop('disabled', false);
                    $("#selectLabId").prop('disabled', false);

                    $("#view").prop('disabled', false);
                    document.getElementById('save').style.pointerEvents = 'auto';

                    };
                    reader.readAsText(filePath.files[0]);
                }
                else if(ActiveXObject && filePath) {
                    try {
                        reader = new ActiveXObject("Scripting.FileSystemObject");
                        var file = reader.OpenTextFile(filePath, 1);
                        output = file.ReadAll();
                        file.Close();
                        displayContents(output);
                    } catch (e) {
                        if (e.number == -2146827859) {
                            alert('Unable to access local files due to browser security settings. ' +
                                'To overcome this, go to Tools->Internet Options->Security->Custom Level. ' +
                                'Find the setting for "Initialize and script ActiveX controls not marked as safe" and change it to "Enable" or "Prompt"');
                        }
                    }
                }
                else { //this is where you could fallback to Java Applet, Flash or similar
                    return false;
                }
                return true;
            }


            //$(function () {
            //    var create = document.querySelector('.create');
            //    var genText = document.querySelector("#genText");
            //    var genSpinner = document.querySelector("#genSpinner");
            //    create.addEventListener("click", function () {
            //        if (validatepage()) {
            //            var str = "Generating..  ";
            //            var result = str.bold();
            //            genText.innerHTML = result;
            //            genSpinner.classList.add('fa');
            //            genSpinner.classList.add('fa-spinner');
            //            genSpinner.classList.add('fa-pulse');

            //            $(window).on("load", function () {
            //                $(".loader-wrapper").fadeOut("slow");
            //                genSpinner.classList.remove('fa');
            //                genSpinner.classList.remove('fa-spinner');
            //                genSpinner.classList.remove('fa-pulse');
            //                genText.innerHTML = "Generate";

            //            });
            //            form.submit();
            //        }


            //    });

            //});
        </script>

    }
</head>
<body>


    @*<div>
            <img id="loader" class="center" src="~/Content/images/loading1.gif" />
        </div>*@
    <h2 style="text-align:center;"><b> Reporting Options </b></h2>



    <div class="loader-wrapper">
        <span class="loader"><span class="loader-inner"></span></span>
    </div>

    <div>
        <button type="submit" id="save" onclick="saveAsTextFile()" class="btn btn-outline-dark"><i class="fa fa-save" style="margin:3px"></i><b>Save</b></button>

        <label for="file-input" style="cursor:pointer; margin:5px;padding:6px" class="border border-dark rounded">
            <i class="fa fa-folder-open-o" style="margin:3px"></i><b>Import</b>
        </label>
        <input id="file-input" type="file" style="display:none;cursor:pointer" onchange='readText(this)' />
        <button id="ref" class="btn btn-outline-dark"><i class="fa fa-refresh" style="margin:3px"></i><b>Refresh</b></button>
    </div>

    @using (Html.BeginForm("Index", "OssLabAdmin", FormMethod.Post, new { name = "form", id = "form" }))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.LCLabID)
        @Html.HiddenFor(m => m.LCLocationName)
        @Html.HiddenFor(m => m.LCLabType)

        <div>
            <hr />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

            <table id="lc_attr" align="center" width="75%">
                <tr>
                    @* <th> @Html.EditorFor(model => model.startDate, new { htmlAttributes = new { @class = "", @Value = Model.startDate, @style = "cursor:pointer;", @onchange = "validatepage()" } })</th> *@

                    <td rowspan="2" class=""> <label style="text-align:right;" class="" for="lab model">Lab Type:</label></td>
                    <td rowspan="2" class=""> @Html.DropDownList("LabType", Model.LabCartypes as List<SelectListItem>, "--Select LabType--", new { @class = "selectpicker", @id = "selectLabType", @style = "cursor:pointer;", multiple = "multiple", @onchange = "fnLabTypeChange(this)" })</td>

                    <td rowspan="2" class=""> <label style="text-align:right;" class="" for="lab location">Site:</label></td>
                    <td rowspan="2" class=""> @Html.DropDownList("Location", Model.Locations as List<SelectListItem>, "--Select Location--", new { @class = "selectpicker", @id = "selectLocation", @style = "cursor:pointer;", multiple = "multiple", @onchange = "fnSitesChange(this)" })</td>

                    <td rowspan="2" class=""> <label style="text-align:right;" class="" for="LabID:">Lab ID:</label></td>
                    <td rowspan="2" class=""> @Html.DropDownList("LabId", Model.LabIDs as List<SelectListItem>, "--Select LabID--", new { @class = "selectpicker", @id = "selectLabId", @style = "cursor:pointer;", @onchange = "fnLabIDChange(this)" })</td>
                </tr>
             </table>
         </div>
      }
</body>
</html>